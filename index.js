var express = require('express');
var app = express();
var bodyParser = require('body-parser')

var files = [
	{
		id: "autogeneratedid",
		filename: "pusty dokument.txt",
		data: "",
		folder: "/home/data/example"
	}
];

app.use(express.static('public'));
app.use(bodyParser.json());


app.get('/file/:id', function(req, res) {
	var id = req.params.id;

	var f = null;    
	for (i=0; i < files.length; i++ ) {
		if (files[i].id == id) {
			f = files[i];
			break;
		}
	}
	if (f == null) {
		res.type("text/plain");
		res.send("Nie mogę odnaleźć pliku o id: " + id);
	} else {
    	res.json(f);
    }
});


app.get('/file/:id', function(req, res) {
	var id = req.params.id;

	var f = null;    
	for (i=0; i < files.length; i++ ) {
		if (files[i].id == id) {
			f = files[i];
			break;
		}
	}
	if (f == null) {
		res.type("text/plain");
		res.send("Nie mogę odnaleźć pliku o id: " + id);
	} else {
    	res.json(f);
    }
});


app.post('/echo', function(req, res) {
	var s = '<p>';
	console.log(req.body);

/*	req.on('data', function(chunk) {
		s += chunk;		
		console.log('Otrzymalem: ' + chunk);
		console.log('Otrzymalem dane: ' + req.body.data);
	});
	req.on('end', function() {
		s += '</p>';
		res.send(s);
	});
*/	
	s += req.body.data;
	s += '</p>';
	res.send(s);
});


app.listen(process.env.PORT || 4730);